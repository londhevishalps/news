<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sustainability News</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* pagination + filter minor styling only */
    #filter-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
    }
    #date-filter {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #fff;
    }
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 10px;
    }
    .pagination button {
      padding: 6px 12px;
      border: none;
      background: #007acc;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .pagination button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <header>
    <h1>Sustainability News</h1>
  </header>

  <main>
    <div id="filter-bar">
      <label for="date-filter">Filter by Date:</label>
      <select id="date-filter">
        <option value="all">All Dates</option>
      </select>
    </div>

    <div id="news-container"></div>
    <div class="pagination">
      <button id="prev-page">Previous</button>
      <button id="next-page">Next</button>
    </div>
  </main>

  <script>
    const newsContainer = document.getElementById('news-container');
    const dateFilter = document.getElementById('date-filter');
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');

    const pageSize = 10;
    let currentPage = 1;
    let articles = [];
    let filteredArticles = [];

    async function loadNews() {
      try {
        const res = await fetch('news.json?_=' + new Date().getTime()); // avoid cache
        const data = await res.json();
        articles = data.articles || [];
        populateDateFilter();
        applyFilter();
      } catch (err) {
        newsContainer.innerHTML = '<p>Failed to load news.</p>';
      }
    }

    function populateDateFilter() {
      const dates = [...new Set(articles.map(a => a.date))].sort((a, b) => {
        const [da, ma, ya] = a.split('-').map(Number);
        const [db, mb, yb] = b.split('-').map(Number);
        return new Date(yb, mb - 1, db) - new Date(ya, ma - 1, da);
      });
      dates.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        dateFilter.appendChild(opt);
      });
    }

    function applyFilter() {
      const selected = dateFilter.value;
      filteredArticles = selected === 'all'
        ? articles
        : articles.filter(a => a.date === selected);
      currentPage = 1;
      renderPage();
    }

    function renderPage() {
      newsContainer.innerHTML = '';
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageArticles = filteredArticles.slice(start, end);

      if (pageArticles.length === 0) {
        newsContainer.innerHTML = '<p>No articles found for this date.</p>';
      } else {
        pageArticles.forEach(a => {
          const card = document.createElement('div');
          card.className = 'news-card';
          card.innerHTML = `
            ${a.image ? `<img src="${a.image}" alt="${a.title}" class="news-img">` : ''}
            <h3><a href="${a.url}" target="_blank">${a.title}</a></h3>
            <p>${a.description || ''}</p>
            <small>${a.source || ''} â€¢ ${a.date}</small>
          `;
          newsContainer.appendChild(card);
        });
      }

      const totalPages = Math.ceil(filteredArticles.length / pageSize);
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === totalPages || totalPages === 0;
    }

    dateFilter.addEventListener('change', applyFilter);
    prevBtn.addEventListener('click', () => { currentPage--; renderPage(); });
    nextBtn.addEventListener('click', () => { currentPage++; renderPage(); });

    loadNews();
  </script>
</body>
</html>
